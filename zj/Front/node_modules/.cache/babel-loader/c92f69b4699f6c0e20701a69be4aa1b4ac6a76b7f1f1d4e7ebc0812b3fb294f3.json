{"ast":null,"code":"import { ref } from \"vue\";\nimport $ from \"jquery\";\nimport { apiUrl } from \"../../config\";\nimport router from \"@/router\";\nimport usePeerStore from \"@/store/peer\";\nimport initializeWebsocket from \"@/plugins/initialize-websocket\";\nimport initializePeer from \"@/plugins/initialize-peer\";\nexport default {\n  __name: 'LoginView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const username = ref('');\n    const password = ref('');\n    const peerStore = usePeerStore();\n    const message = ref('');\n    const login = () => {\n      if (username.value === 'admin' || password.value === 'admin') {\n        router.push(\"/admin-view\");\n      } else {\n        $.ajax({\n          url: `${apiUrl}/api/user/account/token/`,\n          type: \"post\",\n          data: {\n            username: username.value,\n            password: password.value\n          },\n          success(resp) {\n            if (resp.code === 200) {\n              peerStore.token = resp.data.token;\n              getInfo();\n              router.push(\"/setting-view\");\n            } else {\n              message.value = resp.message;\n            }\n          }\n        });\n      }\n    };\n    function getInfo() {\n      $.ajax({\n        url: `${apiUrl}/api/user/account/info/`,\n        type: \"get\",\n        headers: {\n          Authorization: \"Bearer \" + peerStore.token\n        },\n        success(resp) {\n          if (resp.code === 200) {\n            peerStore.userid = resp.data.id;\n            peerStore.role = resp.data.role;\n            peerStore.phone = resp.data.phone;\n            peerStore.username = resp.data.username;\n            peerStore.is_login = true;\n            router.push(\"/setting-view\");\n            initializePeer(peerStore.userid);\n            initializeWebsocket(peerStore.userid);\n          } else {\n            console.log(resp.message);\n          }\n        },\n        error(resp) {\n          console.log(resp);\n        }\n      });\n    }\n    const __returned__ = {\n      username,\n      password,\n      peerStore,\n      message,\n      login,\n      getInfo,\n      ref,\n      get $() {\n        return $;\n      },\n      get apiUrl() {\n        return apiUrl;\n      },\n      get router() {\n        return router;\n      },\n      get usePeerStore() {\n        return usePeerStore;\n      },\n      get initializeWebsocket() {\n        return initializeWebsocket;\n      },\n      get initializePeer() {\n        return initializePeer;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","$","apiUrl","router","usePeerStore","initializeWebsocket","initializePeer","username","password","peerStore","message","login","value","push","ajax","url","type","data","success","resp","code","token","getInfo","headers","Authorization","userid","id","role","phone","is_login","console","log","error"],"sources":["/Users/jiezhou/IdeaProjects/graduaction/zj/Front/src/views/LoginView.vue"],"sourcesContent":["<template>\n  <div class=\"login-container\">\n    <h2>登录</h2>\n    <form @submit.prevent=\"login\">\n      <input type=\"text\" v-model=\"username\" placeholder=\"用户名\"/>\n      <input type=\"password\" v-model=\"password\" placeholder=\"密码\"/>\n      <div class=\"login-error-msg\">{{ message }}</div>\n      <button type=\"submit\">登录</button>\n    </form>\n    <p>还没有账号？\n      <router-link to=\"/register-view\">立即注册</router-link>\n    </p>\n  </div>\n</template>\n\n<script setup>\nimport {ref} from \"vue\";\nimport $ from \"jquery\";\nimport {apiUrl} from \"../../config\";\nimport router from \"@/router\";\nimport usePeerStore from \"@/store/peer\";\nimport initializeWebsocket from \"@/plugins/initialize-websocket\";\nimport initializePeer from \"@/plugins/initialize-peer\";\n\nconst username = ref('');\nconst password = ref('');\nconst peerStore = usePeerStore();\nconst message = ref('');\n\nconst login = () => {\n  if (username.value === 'admin' || password.value === 'admin') {\n    router.push(\"/admin-view\");\n  }else {\n    $.ajax({\n      url: `${apiUrl}/api/user/account/token/`,\n      type: \"post\",\n      data: {\n        username: username.value,\n        password: password.value,\n      },\n      success(resp) {\n        if (resp.code === 200) {\n          peerStore.token = resp.data.token;\n          getInfo();\n          router.push(\"/setting-view\");\n        } else {\n          message.value = resp.message;\n        }\n      },\n    });\n  }\n}\n\nfunction getInfo() {\n  $.ajax({\n    url: `${apiUrl}/api/user/account/info/`,\n    type: \"get\",\n    headers: {\n      Authorization: \"Bearer \" + peerStore.token,\n    },\n    success(resp) {\n      if (resp.code === 200) {\n        peerStore.userid = resp.data.id;\n        peerStore.role = resp.data.role;\n        peerStore.phone = resp.data.phone;\n        peerStore.username = resp.data.username;\n        peerStore.is_login = true;\n        router.push(\"/setting-view\");\n        initializePeer(peerStore.userid);\n        initializeWebsocket(peerStore.userid);\n      } else {\n        console.log(resp.message)\n      }\n    },\n    error(resp) {\n      console.log(resp)\n    }\n  })\n}\n\n\n</script>\n<style scoped>\n.login-container {\n  max-width: 400px;\n  margin: 0 auto;\n  padding: 20px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n}\n\n.login-container h2 {\n  text-align: center;\n}\n\n.login-container form {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  margin-top: 20px;\n}\n\n.login-container input[type=\"text\"],\n.login-container input[type=\"password\"] {\n  padding: 8px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n}\n\n.login-container button {\n  padding: 8px;\n  background-color: #007bff;\n  color: #fff;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n}\n</style>"],"mappings":"AAgBA,SAAQA,GAAG,QAAO,KAAK;AACvB,OAAOC,CAAC,MAAM,QAAQ;AACtB,SAAQC,MAAM,QAAO,cAAc;AACnC,OAAOC,MAAM,MAAM,UAAU;AAC7B,OAAOC,YAAY,MAAM,cAAc;AACvC,OAAOC,mBAAmB,MAAM,gCAAgC;AAChE,OAAOC,cAAc,MAAM,2BAA2B;;;;;;;IAEtD,MAAMC,QAAQ,GAAGP,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMQ,QAAQ,GAAGR,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMS,SAAS,GAAGL,YAAY,CAAC,CAAC;IAChC,MAAMM,OAAO,GAAGV,GAAG,CAAC,EAAE,CAAC;IAEvB,MAAMW,KAAK,GAAGA,CAAA,KAAM;MAClB,IAAIJ,QAAQ,CAACK,KAAK,KAAK,OAAO,IAAIJ,QAAQ,CAACI,KAAK,KAAK,OAAO,EAAE;QAC5DT,MAAM,CAACU,IAAI,CAAC,aAAa,CAAC;MAC5B,CAAC,MAAK;QACJZ,CAAC,CAACa,IAAI,CAAC;UACLC,GAAG,EAAG,GAAEb,MAAO,0BAAyB;UACxCc,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE;YACJV,QAAQ,EAAEA,QAAQ,CAACK,KAAK;YACxBJ,QAAQ,EAAEA,QAAQ,CAACI;UACrB,CAAC;UACDM,OAAOA,CAACC,IAAI,EAAE;YACZ,IAAIA,IAAI,CAACC,IAAI,KAAK,GAAG,EAAE;cACrBX,SAAS,CAACY,KAAK,GAAGF,IAAI,CAACF,IAAI,CAACI,KAAK;cACjCC,OAAO,CAAC,CAAC;cACTnB,MAAM,CAACU,IAAI,CAAC,eAAe,CAAC;YAC9B,CAAC,MAAM;cACLH,OAAO,CAACE,KAAK,GAAGO,IAAI,CAACT,OAAO;YAC9B;UACF;QACF,CAAC,CAAC;MACJ;IACF,CAAC;IAED,SAASY,OAAOA,CAAA,EAAG;MACjBrB,CAAC,CAACa,IAAI,CAAC;QACLC,GAAG,EAAG,GAAEb,MAAO,yBAAwB;QACvCc,IAAI,EAAE,KAAK;QACXO,OAAO,EAAE;UACPC,aAAa,EAAE,SAAS,GAAGf,SAAS,CAACY;QACvC,CAAC;QACDH,OAAOA,CAACC,IAAI,EAAE;UACZ,IAAIA,IAAI,CAACC,IAAI,KAAK,GAAG,EAAE;YACrBX,SAAS,CAACgB,MAAM,GAAGN,IAAI,CAACF,IAAI,CAACS,EAAE;YAC/BjB,SAAS,CAACkB,IAAI,GAAGR,IAAI,CAACF,IAAI,CAACU,IAAI;YAC/BlB,SAAS,CAACmB,KAAK,GAAGT,IAAI,CAACF,IAAI,CAACW,KAAK;YACjCnB,SAAS,CAACF,QAAQ,GAAGY,IAAI,CAACF,IAAI,CAACV,QAAQ;YACvCE,SAAS,CAACoB,QAAQ,GAAG,IAAI;YACzB1B,MAAM,CAACU,IAAI,CAAC,eAAe,CAAC;YAC5BP,cAAc,CAACG,SAAS,CAACgB,MAAM,CAAC;YAChCpB,mBAAmB,CAACI,SAAS,CAACgB,MAAM,CAAC;UACvC,CAAC,MAAM;YACLK,OAAO,CAACC,GAAG,CAACZ,IAAI,CAACT,OAAO,CAAC;UAC3B;QACF,CAAC;QACDsB,KAAKA,CAACb,IAAI,EAAE;UACVW,OAAO,CAACC,GAAG,CAACZ,IAAI,CAAC;QACnB;MACF,CAAC,CAAC;IACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}